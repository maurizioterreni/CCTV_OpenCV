<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<ui:composition template="/layout/template.xhtml">

	<ui:define name="body">

		<div class="container">

			<c:if test="#{userProtectedBean.currentUser}">
			
				<h:panelGroup styleClass="page-header" layout="block">
					<ol class="breadcrumb">
						<li>
							<h:link outcome="/home">
								<h:outputText value="Home" />
							</h:link>
						</li>
						<li class="active">
							<h:outputText value="Change Password" />
						</li>
					</ol>
					<h1>Change Password</h1>
				</h:panelGroup>
				
				<h:form style="max-width: 500px; margin: 0 auto;">
					<h:panelGroup rendered="#{param['error']}" layout="block" 
								styleClass="alert alert-danger" role="alert">
						<h:outputText value="Incomplete data submitted" rendered="#{param['cause'] eq 'nullvalues'}" />
						<h:outputText value="Current password is incorrect" rendered="#{param['cause'] eq 'current'}" />
						<h:outputText value="New password is too short (minimum lenght is 6 characters)" 
										rendered="#{param['cause'] eq 'short'}" />
						<h:outputText value="New passwords input don't match" rendered="#{param['cause'] eq 'different'}" />
					</h:panelGroup>
					
					<h:panelGroup rendered="#{param['success']}" layout="block" 
								styleClass="alert alert-success" role="alert">
						<h:outputText value="Password succesfully changed" />
					</h:panelGroup>
					
					<div class="form-group row">
						<h:outputLabel class="col-sm-5 control-label" value="Current Password"/>
						<div class="col-sm-7">
							<h:inputSecret value="#{changePasswordBean.currentPassword}" 
										styleClass="form-control length" />
						</div>
					</div>
					<div class="form-group row">
						<h:outputLabel class="col-sm-5 control-label" value="New Password"/>
						<div class="col-sm-7">
							<h:inputSecret value="#{changePasswordBean.newPassword}" 
										styleClass="form-control length" />
						</div>
					</div>
					<div class="form-group row">
						<h:outputLabel class="col-sm-5 control-label" value="New Password (Type Again)"/>
						<div class="col-sm-7">
							<h:inputSecret value="#{changePasswordBean.newPasswordAgain}" 
										styleClass="form-control length" />
						</div>
					</div>
					<h:commandLink styleClass="btn btn-primary" value="Change"
									action="#{changePasswordBean.change()}" >
						<f:param name="uz" value="#{loginBean.user.id}"/>
					</h:commandLink>
				</h:form>
			
			</c:if>
		</div>
		
	</ui:define>
	
	<ui:define name="scripts">
		<h:outputScript library="js" name="jquery.form-validator.min.js" />
		<script type="text/javascript">
			function preventSubmit(data) {
				$('#collapseArea').collapse('hide');
				if(data.status == "success") {
					$('#add-areas-form a').click(function() {
						$(this).attr('disabled', 'disabled')
					})
				}
			}
		
			$(function() {
				$('.length').attr('data-validation', 'length');
				$('.length').attr('data-validation-length', 'min6');
				$('.number').attr('data-validation', 'number');
				$.validate();

				preventSubmit({status: 'success'});
			})
		</script>
	</ui:define>
</ui:composition>
</html>